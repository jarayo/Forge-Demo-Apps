<!DOCTYPE html>
<html>
	<head>
		<title>Test Runner</title>
		<script src="jquery.min.js"></script>
		<script>
		var go = function () {
			$('#results').html('Loading...');
			forge.tabs.openWithOptions({
				url: 'https://www.facebook.com/dialog/oauth?client_id=319333711443283&redirect_uri=fb319333711443283://authorize&display=touch&response_type=token',
				pattern: 'fb319333711443283://authorize/*'
			}, function (data) {
				var params = {}, queryString = data.url.substring(data.url.indexOf('#')+1),
				    regex = /([^&=]+)=([^&]*)/g, m;
				while (m = regex.exec(queryString)) {
					params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
				}
				
				forge.request.ajax({
					url: 'https://graph.facebook.com/me?access_token='+params['access_token'],
					dataType: 'json',
					success: function (data) {
						$('#results').html('<div>Name: '+data.name+'<br>Email: '+data.email+'<br>Gender: '+data.gender+'<br>Link: <a href="#" onclick="forge.tabs.open(\''+data.link+'\')">'+data.link+'</a></div>');
					}
				});
			});
		};
		</script>
	</head>
	<body>
		<h1>Facebook authentication example</h1>
		<div id="results"><a href="#" onclick="go()">Load details</a></div>
	</body>
</html>